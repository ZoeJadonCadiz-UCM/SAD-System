<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Maintenance & UpKeep</title>
        <link rel="stylesheet" href="../css/Upkeep.css">
        <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    </head>

        <body>

                        <nav class="navbar">
                            <div class = "nav-left">
                                <a href="account.html" class = "nav-btn active-page">Account</a>
                            </div>

                            <div classs = "nav-right">
                                <a href="dashboard.html" class ="nav-btn">Dashboard</a>
                                <a href="payments.html" class ="nav-btn">Payments</a>
                                <a href="tenants.html" class ="nav-btn">Tenants</a>
                                <a href="Upkeep.html" class ="nav-btn1">UpKeep</a>
                                <a href="../../login/html/login.html" class ="nav-btn">Log-out</a>
                            </div>
                        </nav>

            <div class="container">

                <div class="top-section">

                    <div class="box maintenance-box">
                        <h3 class = "heading-box">Maintenance & UpKeep</h3>
                        <div class="status-grid">
                            <div class="status-card">
                                <p>Pending<br>Request</p>
                                <span class="count yellow" id="pendingCount">2</span>
                            </div>
                            <div class="status-card">
                                <p>In<br>Progress</p>
                                <span class="count blue" id="inProgressCount">2</span>
                            </div>
                            <div class="status-card">
                                <p>Completed</p>
                                <span class="count green" id="completedCount">2</span>
                            </div>
                            <div class="status-card">
                                <p>Urgent<br>Request</p>
                                <span class="count red" id="urgentCount">1</span>
                            </div>
                        </div>
                    </div>

                    <div class="box search-box">
                        <div class="search-wrap">
                                    <input type="text" placeholder="Search...">
                                </div>
                    </div>

                </div>

                <div class="table-section box">

                    <div class="table-header">
                        <h3 class = "heading-box">Maintenance Requests</h3>
                        <div class="sort-dropdown">
                            <button id="clearTableBtn">Clear</button>
                        </div>
                    </div>


                    <table>
                        <thead>
                            <tr>
                                <th>Room</th>
                                <th>Tenant Name</th>
                                <th>Issue</th>
                                <th>Priority</th>
                                <th>Date Received</th>
                                <th>Status</th>
                            </tr>
                        </thead>

                        <tbody id="requestsTableBody">

                            <tr>
                                <td>101</td>
                                <td class="link">Sarah Johnson</td>
                                <td>Leaky Faucet</td>
                                <td><span class="tag low">Low</span></td>
                                <td>11-05-25</td>
                                <td><span class="tag in-progress">In Progress</span></td>
                            </tr>

                            <tr>
                                <td>102</td>
                                <td class="link">Michael Chen</td>
                                <td>Outlet Not Working</td>
                                <td><span class="tag medium">Medium</span></td>
                                <td>11-05-25</td>
                                <td><span class="tag pending">Pending</span></td>
                            </tr>

                            <tr>
                                <td>103</td>
                                <td class="link">Emily Rodriguez</td>
                                <td>AC Not Cooling</td>
                                <td><span class="tag urgent">Urgent</span></td>
                                <td>11-05-25</td>
                                <td><span class="tag pending">Pending</span></td>
                            </tr>

                            <tr>
                                <td>104</td>
                                <td class="link">David Kim</td>
                                <td>Refrigerator Making Noise</td>
                                <td><span class="tag low">Low</span></td>
                                <td>11-05-25</td>
                                <td><span class="tag completed">Completed</span></td>
                            </tr>

                            <tr>
                                <td>105</td>
                                <td class="link">Jessica Williams</td>
                                <td>Door Lock Sticky</td>
                                <td><span class="tag medium">Medium</span></td>
                                <td>11-05-25</td>
                                <td><span class="tag completed">Completed</span></td>
                            </tr>

                        </tbody>
                    </table>

                </div>
            </div>

            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const requestsTableBody = document.getElementById('requestsTableBody');

                    const allRequests = JSON.parse(localStorage.getItem('requests')) || [];
                    const tenants = JSON.parse(localStorage.getItem('tenants')) || {};

                    function renderRequests() {
                        requestsTableBody.innerHTML = '';

                        allRequests.forEach((r, index) => {
                            const tenantData = tenants[r.room] || {};
                            const tenantName = (tenantData.firstName || tenantData.name?.split(" ")[0] || "") + " " +
                                            (tenantData.lastName || tenantData.name?.split(" ").slice(1).join(" ") || r.name || "");

                            const tr = document.createElement('tr');
                            tr.innerHTML = `
                                <td>${r.room}</td>
                                <td class="link">${tenantName}</td>
                                <td>${r.issue}</td>
                                <td><span class="tag ${r.priority.toLowerCase()}">${r.priority}</span></td>
                                <td>${r.date}</td>
                                <td>
                                    <select class="status-select ${r.status.toLowerCase().replace(' ', '-')}">
                                        <option value="Pending" ${r.status === 'Pending' ? 'selected' : ''}>Pending</option>
                                        <option value="In Progress" ${r.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                                        <option value="Completed" ${r.status === 'Completed' ? 'selected' : ''}>Completed</option>
                                    </select>
                                </td>
                            `;
                            requestsTableBody.appendChild(tr);

                            const select = tr.querySelector('.status-select');

                            select.addEventListener('change', (e) => {
                                r.status = e.target.value;
                                select.className = `status-select ${r.status.toLowerCase().replace(' ', '-')}`;
                                updateSummary();
                                localStorage.setItem('requests', JSON.stringify(allRequests));
                            });
                        });

                        updateSummary();
                    }

                    function updateSummary() {
                        const pending = allRequests.filter(r => r.status === 'Pending').length;
                        const inProgress = allRequests.filter(r => r.status === 'In Progress').length;
                        const completed = allRequests.filter(r => r.status === 'Completed').length;
                        const urgent = allRequests.filter(r => r.priority.toLowerCase() === 'urgent' && r.status !== 'Completed').length;

                        document.getElementById('pendingCount').textContent = pending;
                        document.getElementById('inProgressCount').textContent = inProgress;
                        document.getElementById('completedCount').textContent = completed;
                        document.getElementById('urgentCount').textContent = urgent;
                    }

                    const clearBtn = document.getElementById('clearTableBtn');
                    if (clearBtn) {
                        clearBtn.addEventListener('click', () => {

                            requestsTableBody.innerHTML = '';

                            document.getElementById('pendingCount').textContent = '0';
                            document.getElementById('inProgressCount').textContent = '0';
                            document.getElementById('completedCount').textContent = '0';
                            document.getElementById('urgentCount').textContent = '0';
                        });
                    }

                    renderRequests();
                });
                </script>

        </body>
</html>
