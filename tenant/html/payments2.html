<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Payment Dashboard</title>
        <link rel="stylesheet" href="../css/payments.css" />
    </head>
    <body>

    <nav class="navbar">
        <div class="nav-left">
            <a href="account2.html" class="nav-btn active-page">Account</a>
        </div>

        <div class="nav-right">
            <a href="dashboard2.html" class="nav-btn">Dashboard</a>
            <a href="payments2.html" class="nav-btn1">Payments</a>
            <a href="room.html" class="nav-btn">Room</a>
            <a href="Upkeep2.html" class="nav-btn">UpKeep</a>
            <a href="../../login/html/login.html" class="nav-btn logout">Log-out</a>
        </div>
    </nav>

    <div class="container">

        <div class="card">
            <span class="card-header">Due Payment</span>

            <div class="search-box">
                <input class="search-input" placeholder="Search..." />
            </div>

            <div class="payment-boxes">
                <div class="box">
                    <div>Monthly Rent</div>
                    <div class="price-green" id="totalRevenue">$0</div>
                </div>

                <div class="box">
                    <div>Pending Payments<br>(Overdues)</div>
                    <div class="price-orange" id="pendingPayments">$0</div>
                </div>
            </div>
        </div>

        <div class="card">
            <span class="card-header">Payment History</span>

            <table>
                <thead>
                    <tr>
                        <th>Monthly Payment</th>
                        <th>Due Date</th>
                        <th>Paid On</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="paymentsTableBody">
                </tbody>
            </table>

            <div class="next-payment" id="nextPaymentDue"></div>
        </div>

    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const tbody = document.getElementById("paymentsTableBody");
            const totalRevenueEl = document.getElementById("totalRevenue");
            const pendingPaymentsEl = document.getElementById("pendingPayments");
            const nextPaymentEl = document.getElementById("nextPaymentDue");

            const FIXED_AMOUNT = 450;

            const currentTenant = JSON.parse(localStorage.getItem("currentTenant"));
            if (!currentTenant || !currentTenant.email) {
                tbody.innerHTML = `<tr><td colspan="4">Please log in.</td></tr>`;
                totalRevenueEl.textContent = "$0";
                pendingPaymentsEl.textContent = "$0";
                nextPaymentEl.textContent = "Next Payment Due: --";
                return;
            }

            const tenants = JSON.parse(localStorage.getItem("tenants")) || {};

            // --- Find tenant using email from currentTenant ---
            const tenant = Object.values(tenants).find(t => t.email === currentTenant.email) || currentTenant;

            if (!tenant || tenant.status !== "Occupied") {
                tbody.innerHTML = `<tr><td colspan="4">No active payments found.</td></tr>`;
                totalRevenueEl.textContent = "$0";
                pendingPaymentsEl.textContent = "$0";
                nextPaymentEl.textContent = "Next Payment Due: --";
                return;
            }

            tbody.innerHTML = "";
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>$${tenant.rent || FIXED_AMOUNT}</td>
                <td>${tenant.dueDate || 'Not Set'}</td>
                <td>${tenant.lastPayment || "------"}</td>
                <td><span class="tag ${tenant.paymentStatus?.toLowerCase() || 'pending'}">${tenant.paymentStatus || "Pending"}</span></td>
            `;
            tbody.appendChild(tr);

            if ((tenant.paymentStatus || '').toLowerCase() === "paid") {
                totalRevenueEl.textContent = `$${tenant.rent || FIXED_AMOUNT}`;
                pendingPaymentsEl.textContent = "$0";
            } else {
                totalRevenueEl.textContent = "$0";
                pendingPaymentsEl.textContent = `$${tenant.rent || FIXED_AMOUNT}`;
            }

            nextPaymentEl.textContent = "Next Payment Due: " + (tenant.dueDate || "--");
        });
        </script>


    </body>
</html>
